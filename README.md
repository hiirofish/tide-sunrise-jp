# 気象庁潮位・日の出データ取得ツール

## 概要
このプログラムは気象庁が公開している潮位表データと日の出・日の入りデータを一括取得するツールです。全国の観測地点のデータを自動的にダウンロードし、整理された形式で保存します。

### 主な機能
1. 潮位データの取得
   - 気象庁が公開している各地点の潮位データを自動ダウンロード
   - 地点ごとのデータを個別ファイルとして保存
2. 日の出・日の入り時刻の計算
   - 各地点の緯度・経度情報を基に日の出・日の入り時刻を計算
   - 年間を通じた毎日のデータを生成
   - ephem ライブラリを使用した高精度な天文学的計算に基づく日の出・日の入り時刻の算出
     - 地点の緯度・経度を使用
     - 大気差（atmospheric refraction）を考慮
     - タイムゾーンに応じた時刻調整

## 必要環境
- Python 3.8以上
- pip（Pythonパッケージインストーラー）

## インストール方法
1. リポジトリのクローン
```bash
git clone https://github.com/[your-username]/tide-sunrise-data-collector.git
cd tide-sunrise-data-collector
```

2. 必要なパッケージのインストール
```bash
pip install -r requirements.txt
```

## 使用方法
### メインプログラムとして実行
```bash
python create_data.py [年度]
# 例: python create_data.py 2025
```

### 個別プログラムとして実行
```bash
# 日の出・日の入りデータのみ生成
python all_hinode.py 2025

# 潮位データのみダウンロード
python master_tide.py 2025
```

## 出力データ
### フォルダ構造
```
data_[年度]/
  ├─ hinode/
  │   └─ hinode_[年度]_[地点コード]_hinode.txt
  └─ tide/
      └─ tide_[年度]_[地点コード].txt
```

### データ形式
#### 潮位データ
気象庁の公開フォーマットに準拠：
- 毎時潮位（0-23時）
- 満潮・干潮の時刻と潮位
- 詳細は[気象庁潮位表フォーマット](https://www.data.jma.go.jp/gmd/kaiyou/db/tide/suisan/readme.html)を参照

#### 日の出・日の入りデータ
```
MMDD HHMM HHMM  # 月日 日の出時刻 日の入り時刻
```

### 日の出・日の入り時刻の計算方法
本プログラムでは、suntimeライブラリを使用して日の出・日の入り時刻を計算しています：

1. 計算の基本要素
   - 地点の緯度・経度情報
   - 計算対象の日付
   - 地方標準時（日本標準時）

2. 計算プロセス
   - 太陽の視位置の計算
   - 大気差（atmospheric refraction）の考慮
   - 地平線に対する太陽の位置計算
   - JSTへの正確な時刻変換（+9時間）

3. 特殊なケース
   - 極夜や白夜が発生する可能性がある高緯度地点での例外処理
   - エラーが発生した場合のログ記録

## データソース
- 潮位データ: 気象庁潮位表
- 地点情報: keisai.tsv（緯度・経度情報を含む）

## 参考情報
- [気象庁潮位表について](https://www.data.jma.go.jp/gmd/kaiyou/db/tide/suisan/readme.html)
- 潮位表フォーマット詳細:
  - PDF版（満潮・干潮の時刻と潮位）
  - PDF版（毎時潮位、満潮・干潮の時刻と潮位）
  - テキストデータ版（毎時潮位、満潮・干潮の時刻と潮位）
- 月齢カレンダー情報はhttps://koyomi8.com/databox.html#mooncalを参考

## 注意事項
- 本プログラムは気象庁が公開しているデータを利用しています
- データの利用には気象庁の利用規約が適用されます
- 取得したデータの使用については、気象庁の規約に従ってください

## requirements.txt
```
pandas
requests
ephem
```